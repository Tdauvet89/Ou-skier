<script type="text/babel">
    const { useState, useEffect } = React;

    // --- FONCTIONS UTILITAIRES (Fix du bug) ---
    const getWindDirectionDisplay = (deg) => {
        if (deg === null || deg === undefined) return { cardinal: "N/A" };
        const sectors = ["N", "NE", "E", "SE", "S", "SO", "O", "NO"];
        const index = Math.round(deg / 45) % 8;
        return { cardinal: sectors[index] };
    };

    const DEFAULT_RESORTS = [
        { name: "Guzet", lat: 42.7857, lon: 1.2261, altitude: 1400 },
        { name: "Piau-Engaly", lat: 42.7833, lon: 0.1667, altitude: 1850 },
        { name: "Saint-Lary", lat: 42.8167, lon: 0.3167, altitude: 1700 },
    ];

    function MountainWeatherApp() {
        // ... reste de ton code identique ...
        const [resorts, setResorts] = useState(DEFAULT_RESORTS);
        const [weatherData, setWeatherData] = useState([]);
        const [viewMode, setViewMode] = useState("day");
        const [braData, setBraData] = useState({});

        // Mock data pour le test
        useEffect(() => {
            const mock = resorts.map(r => ({
                name: r.name,
                days: Array(5).fill(0).map((_, i) => ({
                    condition: "Beau temps",
                    icon: weatherSvg.sun,
                    temp_min: -2, temp_max: 8,
                    wind_mean: 15, windDirection: 180,
                    gust_min: 20, gust_max: 30,
                    snowCm: i === 2 ? 10 : 0
                }))
            }));
            setWeatherData(mock);
        }, []);

        return (
            <div className="container">
                {/* Ton Header Sticky */}
                <header>
                    <h1>Ski Rando Météo</h1>
                </header>

                <main className="main-content">
                    {/* TABLEAU 1 (ANCIEN) */}
                    <section className="section">
                        <h2>Météo Comparative (5 jours)</h2>
                        {/* ... ancien tableau ... */}
                    </section>

                    {/* TABLEAU 2 (NOUVEAU DESIGN TEST) */}
                    {weatherData.length > 0 && (
                        <section className="section">
                            <h2 style={{marginTop: '40px'}}>Nouveau Design (Test)</h2>
                            <div className="new-weather-card">
                                <div className="new-table-container">
                                    <table className="new-weather-table">
                                        <thead>
                                            <tr>
                                                <th className="th-sector">Secteur</th>
                                                {[0,1,2,3,4].map(i => (
                                                    <th key={i} className="th-date">Jour {i+1}</th>
                                                ))}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {weatherData.map((resort, idx) => (
                                                <tr key={idx}>
                                                    <td className="td-sector">{resort.name}</td>
                                                    {resort.days.map((day, i) => (
                                                        <td key={i}>
                                                            <div className="weather-cell-inner">
                                                                <div className="weather-left-col">
                                                                    <div dangerouslySetInnerHTML={{__html: day.icon}}></div>
                                                                    <div className="weather-condition-label">{day.condition}</div>
                                                                </div>
                                                                <div className="weather-right-col">
                                                                    <div className="weather-temp-main">{Math.round((day.temp_max+day.temp_min)/2)}°</div>
                                                                    <div className="weather-detail-row">
                                                                        {/* Utilisation de la fonction fixée */}
                                                                        <span dangerouslySetInnerHTML={{__html: windArrowSvg(day.windDirection, 14)}}></span>
                                                                        {getWindDirectionDisplay(day.windDirection).cardinal} {day.wind_mean}km/h
                                                                    </div>
                                                                    {day.snowCm > 0 && <div className="precip-badge">❄️ {day.snowCm}cm</div>}
                                                                </div>
                                                            </div>
                                                        </td>
                                                    ))}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </section>
                    )}
                </main>
            </div>
        );
    }

    ReactDOM.render(<MountainWeatherApp />, document.getElementById("root"));
</script>
