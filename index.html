<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√©t√©o Montagne - Dashboard Ski</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --deep-blue: #1a5276;
            --glacier: #5dade2;
            --powder: #d4e9f7;
            --storm-gray: #5d6d7e;
            --fresh-green: #27ae60;
            --shadow-blue: rgba(0,0,0,0.1);
            --ice-blue: #d4e9f7;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background-color: #f4f7f9;
            margin: 0;
            color: var(--storm-gray);
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        header {
            background: linear-gradient(135deg, var(--deep-blue), var(--glacier));
            color: white;
            padding: 40px 20px;
            border-radius: 0 0 20px 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        h1 { font-family: 'Barlow Condensed', sans-serif; font-size: 3rem; margin: 0; text-transform: uppercase; }

        .weather-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px var(--shadow-blue);
            margin-bottom: 30px;
            overflow-x: auto;
        }

        h2 { font-family: 'Barlow Condensed', sans-serif; color: var(--deep-blue); border-left: 5px solid var(--glacier); padding-left: 15px; }

        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: var(--powder); color: var(--deep-blue); padding: 12px; text-align: center; font-size: 0.9rem; }
        td { border-bottom: 1px solid #eee; padding: 10px; text-align: center; }

        .resort-name { font-weight: 800; text-align: left; color: var(--deep-blue); font-family: 'Barlow Condensed', sans-serif; font-size: 1.1rem; }
        .altitude { font-weight: 400; font-size: 0.85rem; color: var(--storm-gray); opacity: 0.8; }

        .day-header { background: #f8f9fa; font-weight: bold; border-right: 2px solid #ddd; }
        .hour-cell { border-right: 1px solid #f0f0f0; padding: 5px; }
        .cell-icon { font-size: 1.4rem; }
        .cell-temp { font-weight: 700; color: #333; }
        .cell-wind { font-size: 0.75rem; color: #777; }
        
        .loading { text-align: center; padding: 50px; font-style: italic; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // ==========================================
        // CONFIGURATION DES ICONES METEOBLUE
        // ==========================================
        const WEATHER_CONFIG = {
            pictograms: {
                1:  { icon: '‚òÄÔ∏è', desc: 'Clair' },
                2:  { icon: 'üå§Ô∏è', desc: 'Plut√¥t ensoleill√©' },
                3:  { icon: '‚õÖ', desc: 'Partiellement nuageux' },
                4:  { icon: '‚òÅÔ∏è', desc: 'Nuageux' },
                5:  { icon: '‚òÅÔ∏è', desc: 'Couvert' },
                6:  { icon: 'üå¶Ô∏è', desc: 'Averses' },
                7:  { icon: 'üå¶Ô∏è', desc: 'Pluie et averses isol√©es' },
                8:  { icon: 'üåßÔ∏è', desc: 'Pluie' },
                9:  { icon: '‚ùÑÔ∏è', desc: 'Averses de neige' },
                10: { icon: '‚ùÑÔ∏è', desc: 'Neige' },
                11: { icon: '‚õàÔ∏è', desc: 'Orage' },
                12: { icon: 'üåßÔ∏è', desc: 'Pluie faible' },
                13: { icon: '‚ùÑÔ∏è', desc: 'Neige faible' },
                17: { icon: 'üå´Ô∏è', desc: 'Brouillard' },
                22: { icon: 'üå®Ô∏è', desc: 'Neige faible' },
                24: { icon: 'üå®Ô∏è', desc: 'Neige forte' },
                32: { icon: '‚ùÑÔ∏è', desc: 'Neige forte' },
                34: { icon: '‚òÅÔ∏è', desc: 'Couvert' },
                35: { icon: '‚òÅÔ∏è', desc: 'Nuageux' }
            },
            getIcon: function(code) {
                // Si le code est > 20, c'est souvent une variante montagne/nuit
                const info = this.pictograms[code] || this.pictograms[code - 20] || { icon: '‚òÅÔ∏è', desc: 'Variable' };
                return info;
            }
        };

        const { useState, useEffect } = React;

        function MountainWeatherApp() {
            const [resorts, setResorts] = useState([
                { id: 1, name: "Pic de Lurtet", lat: 42.8691, lon: 0.10149, asl: 2506 },
                { id: 2, name: "Pic du Pourtalet", lat: 42.8020, lon: -0.4140, asl: 2200 },
                { id: 3, name: "Panticosa", lat: 42.7230, lon: -0.2780, asl: 1900 }
            ]);
            const [weatherData, setWeatherData] = useState({});
            const [loading, setLoading] = useState(true);

            const API_KEY = "TON_API_KEY"; // √Ä remplacer par ta cl√© r√©elle

            useEffect(() => {
                const fetchAllWeather = async () => {
                    const results = {};
                    for (const resort of resorts) {
                        try {
                            const url = `https://my.meteoblue.com/packages/basic-1h_basic-day_clouds-1h_clouds-day_snowice-day?apikey=${API_KEY}&lat=${resort.lat}&lon=${resort.lon}&asl=${resort.asl}&format=json`;
                            const response = await fetch(url);
                            const data = await response.json();
                            results[resort.id] = data;
                        } catch (err) {
                            console.error(`Erreur pour ${resort.name}:`, err);
                        }
                    }
                    setWeatherData(results);
                    setLoading(false);
                };
                fetchAllWeather();
            }, []);

            const extractHourlyData = (resortId, targetDate) => {
                const data = weatherData[resortId];
                if (!data || !data.data_1h) return null;

                const hoursToExtract = [8, 10, 12, 14, 16];
                const result = {};
                const times = data.data_1h.time;

                for (let i = 0; i < times.length; i++) {
                    const fullTime = times[i]; // ex: "2026-02-10 08:00"
                    if (!fullTime.startsWith(targetDate)) continue;

                    const hourPart = fullTime.split(' ')[1] || fullTime.split('T')[1];
                    const hour = parseInt(hourPart.substring(0, 2));

                    if (hoursToExtract.includes(hour)) {
                        const pictoCode = data.data_1h.pictocode[i];
                        result[hour] = {
                            temp: Math.round(data.data_1h.temperature[i]),
                            wind: Math.round(data.data_1h.windspeed[i]),
                            icon: WEATHER_CONFIG.getIcon(pictoCode).icon
                        };
                    }
                }
                return result;
            };

            const getNext7Days = () => {
                const days = [];
                for (let i = 0; i < 7; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() + i);
                    days.push(date.toISOString().split('T')[0]);
                }
                return days;
            };

            const next7Days = getNext7Days();

            if (loading) return <div className="loading">Chargement des donn√©es m√©t√©o haute altitude...</div>;

            return (
                <div className="container">
                    <header>
                        <h1>Dashboard M√©t√©o Montagne</h1>
                    </header>

                    <section className="weather-section">
                        <h2>Pr√©visions d√©taill√©es - 7 jours</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Secteur (Altitude)</th>
                                    {next7Days.map(date => (
                                        <th key={date} colSpan="5" className="day-header">
                                            {new Date(date).toLocaleDateString('fr-FR', { weekday: 'short', day: 'numeric' })}
                                        </th>
                                    ))}
                                </tr>
                                <tr>
                                    <th></th>
                                    {next7Days.map(date => (
                                        <React.Fragment key={`hours-${date}`}>
                                            <th>8h</th><th>10h</th><th>12h</th><th>14h</th><th>16h</th>
                                        </React.Fragment>
                                    ))}
                                </tr>
                            </thead>
                            <tbody>
                                {resorts.map(resort => (
                                    <tr key={resort.id}>
                                        <td className="resort-name">
                                            {resort.name} <br/>
                                            <span className="altitude">({resort.asl}m)</span>
                                        </td>
                                        {next7Days.map(date => {
                                            const dayData = extractHourlyData(resort.id, date);
                                            return (
                                                <React.Fragment key={`${resort.id}-${date}`}>
                                                    {[8, 10, 12, 14, 16].map(h => (
                                                        <td key={h} className="hour-cell">
                                                            {dayData && dayData[h] ? (
                                                                <>
                                                                    <div className="cell-icon">{dayData[h].icon}</div>
                                                                    <div className="cell-temp">{dayData[h].temp}¬∞</div>
                                                                    <div className="cell-wind">üí®{dayData[h].wind}</div>
                                                                </>
                                                            ) : '-'}
                                                        </td>
                                                    ))}
                                                </React.Fragment>
                                            );
                                        })}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </section>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MountainWeatherApp />);
    </script>
</body>
</html>
