<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M√©t√©o Montagne - Dashboard Ski</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --ice-blue: #d4e9f7;
            --glacier: #a8d5e2;
            --deep-blue: #1a5276;
            --snow-white: #fafbfc;
            --powder: #e8f4f8;
            --storm-gray: #34495e;
            --warning-orange: #e67e22;
            --fresh-snow: #ecf0f1;
            --shadow-blue: rgba(26, 82, 118, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, #1a5276 0%, #2874a6 50%, #5dade2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--storm-gray);
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px 40px;
            border-radius: 16px 16px 0 0;
            border-bottom: 4px solid var(--glacier);
            box-shadow: 0 4px 20px var(--shadow-blue);
        }

        h1 {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--deep-blue);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 8px;
            text-shadow: 2px 2px 0 var(--glacier);
        }

        .subtitle {
            font-size: 0.95rem;
            color: var(--storm-gray);
            font-weight: 500;
            letter-spacing: 1px;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .date-display {
            flex: 1;
            padding: 12px 20px;
            background: var(--powder);
            border-left: 4px solid var(--deep-blue);
            border-radius: 6px;
            font-size: 0.9rem;
            color: var(--deep-blue);
            font-weight: 500;
        }

        .refresh-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--deep-blue), #2874a6);
            color: white;
            border: none;
            border-radius: 6px;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .refresh-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.98);
            padding: 40px;
            border-radius: 0 0 16px 16px;
            box-shadow: 0 10px 40px var(--shadow-blue);
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            font-size: 1.2rem;
            color: var(--deep-blue);
        }

        .error {
            background: #ffe5e5;
            border: 2px solid #ff4444;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            color: #cc0000;
        }

        .section {
            margin-bottom: 50px;
            animation: fadeIn 0.8s ease-out backwards;
        }

        .section:nth-child(1) { animation-delay: 0.1s; }
        .section:nth-child(2) { animation-delay: 0.2s; }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h2 {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--deep-blue);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--glacier);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .icon {
            font-size: 1.8rem;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        thead {
            background: linear-gradient(135deg, var(--deep-blue) 0%, #2874a6 100%);
            color: white;
        }

        th {
            padding: 18px 16px;
            text-align: left;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        th:first-child {
            border-radius: 12px 0 0 0;
            font-size: 1.1rem;
            min-width: 180px;
        }

        th:last-child {
            border-radius: 0 12px 0 0;
            border-right: none;
        }

        tbody tr {
            transition: all 0.3s ease;
            background: white;
        }

        tbody tr:nth-child(even) {
            background: var(--fresh-snow);
        }

        tbody tr:hover {
            background: var(--powder);
            transform: scale(1.005);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        td {
            padding: 16px;
            border-right: 1px solid #e0e0e0;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        td:first-child {
            font-weight: 600;
            color: var(--deep-blue);
            font-size: 1rem;
            background: rgba(212, 233, 247, 0.3);
        }

        td:last-child {
            border-right: none;
        }

        .snow-value {
            font-weight: 600;
            color: var(--deep-blue);
            font-size: 1.05rem;
        }

        .heavy-snow {
            color: var(--warning-orange);
            font-weight: 700;
        }

        .date-header {
            font-size: 0.85rem;
            opacity: 0.9;
            display: block;
            margin-top: 4px;
            font-weight: 400;
        }

        .weather-icon {
            font-size: 1.5rem;
            margin-right: 8px;
            vertical-align: middle;
        }

        .temp {
            font-weight: 600;
            color: var(--deep-blue);
        }

        .temp-cold {
            color: #3498db;
        }

        .temp-warm {
            color: var(--warning-orange);
        }

        .conditions {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .wind-info {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 4px;
        }

        .legend {
            margin-top: 20px;
            padding: 15px 20px;
            background: var(--powder);
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--storm-gray);
            border-left: 4px solid var(--glacier);
        }

        .legend-item {
            display: inline-block;
            margin-right: 25px;
            margin-bottom: 5px;
        }

        /* Toggle View Switch */
        .view-toggle-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: var(--powder);
            border-radius: 8px;
        }

        .view-toggle {
            display: flex;
            background: white;
            border-radius: 8px;
            padding: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .view-toggle-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s ease;
            color: var(--storm-gray);
        }

        .view-toggle-btn.active {
            background: linear-gradient(135deg, var(--deep-blue), #2874a6);
            color: white;
            box-shadow: 0 2px 6px rgba(26, 82, 118, 0.3);
        }

        .view-toggle-btn:hover:not(.active) {
            background: var(--powder);
        }

        /* Unified Table */
        .unified-weather-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .unified-table-wrapper {
            overflow-x: auto;
            border-radius: 12px;
        }

        .sticky-first-col {
            position: sticky;
            left: 0;
            z-index: 5;
            background: rgba(212, 233, 247, 0.95);
            font-weight: 600;
            color: var(--deep-blue);
            font-size: 0.85rem;
            min-width: 160px;
            max-width: 160px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.05);
        }

        .day-col-header {
            text-align: center;
            padding: 12px 8px;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            line-height: 1.3;
            min-width: 140px;
        }

        .day-col-header.today-col {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .hourly-col-header {
            text-align: center;
            padding: 8px 4px;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--deep-blue);
            min-width: 90px;
            border-left: 1px solid rgba(255,255,255,0.3);
        }

        .hourly-col-header:first-of-type {
            border-left: none;
        }

        .day-cell {
            text-align: center;
            padding: 10px 6px;
            border-right: 2px solid var(--glacier);
            min-width: 140px;
            vertical-align: middle;
        }

        .day-cell.today-cell {
            background: rgba(39, 174, 96, 0.08);
        }

        .hourly-cell {
            text-align: center;
            padding: 8px 4px;
            border-left: 1px solid #f0f0f0;
            min-width: 90px;
            vertical-align: middle;
        }

        .hourly-cell.today-cell {
            background: rgba(39, 174, 96, 0.08);
        }

        .cell-icon {
            font-size: 1.4rem;
            margin: 2px 0;
        }

        .cell-temp {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--storm-gray);
            margin: 3px 0;
        }

        .cell-wind {
            font-size: 0.65rem;
            color: #7f8c8d;
            margin-top: 2px;
        }

        .cell-temp-range {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--storm-gray);
        }

        /* Tableau horaire d√©taill√© */
        .hourly-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            overflow-x: auto;
            display: block;
        }

        .hourly-table thead,
        .hourly-table tbody {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        .resort-header-sticky {
            position: sticky;
            left: 0;
            z-index: 10;
            background: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            padding: 15px 20px;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.3rem;
            color: var(--deep-blue);
            border-bottom: 2px solid var(--glacier);
            min-width: 200px;
            max-width: 200px;
        }

        .day-column {
            text-align: center;
            vertical-align: top;
            border-right: 2px solid var(--glacier);
            padding: 0;
            min-width: 180px;
            max-width: 180px;
        }

        .day-column:last-child {
            border-right: none;
        }

        .day-header {
            background: linear-gradient(135deg, var(--deep-blue) 0%, #2874a6 100%);
            color: white;
            padding: 10px 6px;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            line-height: 1.3;
        }

        .day-header.today-header {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        .hourly-slots {
            display: flex;
            flex-direction: row;
            border-top: 1px solid #e0e0e0;
        }

        .hour-slot {
            flex: 1;
            padding: 6px 3px;
            border-right: 1px solid #f0f0f0;
            min-width: 60px;
        }

        .hour-slot:last-child {
            border-right: none;
        }

        .hour-time {
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--deep-blue);
            margin-bottom: 4px;
        }

        .hour-icon {
            font-size: 1.3rem;
            margin: 3px 0;
        }

        .hour-temp {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--storm-gray);
            margin: 3px 0;
        }

        .temp-trend {
            font-size: 0.6rem;
            color: #95a5a6;
        }

        .hour-wind {
            font-size: 0.65rem;
            color: #7f8c8d;
            margin-top: 3px;
        }

        .wind-trend {
            font-size: 0.6rem;
            color: #95a5a6;
        }

        .trend-up {
            color: #e74c3c;
        }

        .trend-down {
            color: #3498db;
        }

        .trend-stable {
            color: #95a5a6;
        }

        .weather-table-wrapper {
            overflow-x: auto;
            margin-bottom: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .weather-table-container {
            display: flex;
            min-width: fit-content;
        }

        .resort-name-column {
            position: sticky;
            left: 0;
            z-index: 10;
            background: linear-gradient(135deg, var(--deep-blue) 0%, #2874a6 100%);
            color: white;
            padding: 15px 20px;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            text-transform: uppercase;
            display: flex;
            align-items: center;
            min-width: 200px;
            max-width: 200px;
            box-shadow: 3px 0 8px rgba(0,0,0,0.15);
        }

        .days-container {
            display: flex;
            flex: 1;
        }

        .past-day {
            opacity: 0.7;
            background: #f8f9fa !important;
        }

        .today {
            background: linear-gradient(135deg, rgba(168, 213, 226, 0.2), rgba(212, 233, 247, 0.2)) !important;
            border: 2px solid var(--glacier);
        }

        .future-day {
            background: white !important;
        }

        .add-resort-btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(39, 174, 96, 0.3);
            margin-top: 10px;
        }

        .add-resort-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeInOverlay 0.3s ease-out;
        }

        @keyframes fadeInOverlay {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideInModal 0.3s ease-out;
        }

        @keyframes slideInModal {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--deep-blue);
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid var(--glacier);
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--deep-blue);
        }

        .search-results {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .search-result-item {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-result-item:hover {
            background: var(--powder);
            border-color: var(--glacier);
            transform: translateX(5px);
        }

        .result-name {
            font-weight: 700;
            color: var(--deep-blue);
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .result-info {
            font-size: 0.85rem;
            color: #7f8c8d;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .modal-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-cancel {
            background: #95a5a6;
            color: white;
        }

        .modal-btn-cancel:hover {
            background: #7f8c8d;
        }

        .loading-search {
            text-align: center;
            padding: 20px;
            color: var(--deep-blue);
            font-style: italic;
        }

        .no-results {
            text-align: center;
            padding: 20px;
            color: #95a5a6;
        }

        .resort-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .resort-tag {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: var(--glacier);
            color: var(--deep-blue);
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .remove-resort {
            background: none;
            border: none;
            color: var(--deep-blue);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .remove-resort:hover {
            background: var(--deep-blue);
            color: white;
        }

        @media (max-width: 1200px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .main-content {
                padding: 25px;
            }

            table {
                font-size: 0.85rem;
            }

            th, td {
                padding: 12px 10px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            .main-content {
                padding: 20px;
            }

            table {
                font-size: 0.75rem;
            }

            th, td {
                padding: 10px 6px;
            }

            .date-header {
                font-size: 0.7rem;
            }

            .legend-item {
                display: block;
                margin-bottom: 8px;
            }

            .resort-inputs {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Configuration des secteurs de ski avec coordonn√©es
        const DEFAULT_RESORTS = [
            { name: "Guzet", lat: 42.7857, lon: 1.2261, altitude: 1400 },
            { name: "Piau-Engaly", lat: 42.7833, lon: 0.1667, altitude: 1850 },
            { name: "Saint-Lary", lat: 42.8167, lon: 0.3167, altitude: 1700 }
        ];

        const API_KEY = '76O0zHESUwlL5kA1';

        // Mapping des codes m√©t√©o Meteoblue vers ic√¥nes et descriptions
        const weatherCodeToIcon = {
            1: { icon: '‚òÄÔ∏è', desc: 'Ensoleill√©' },
            2: { icon: '‚õÖ', desc: 'Peu nuageux' },
            3: { icon: '‚õÖ', desc: 'Partiellement nuageux' },
            4: { icon: '‚òÅÔ∏è', desc: 'Nuageux' },
            5: { icon: 'üåßÔ∏è', desc: 'Pluie' },
            6: { icon: 'üåßÔ∏è', desc: 'Averses' },
            7: { icon: '‚ùÑÔ∏è', desc: 'Neige' },
            8: { icon: 'üå®Ô∏è', desc: 'Averses de neige' },
            9: { icon: '‚õàÔ∏è', desc: 'Orage' }
        };

        function AddResortModal({ isOpen, onClose, onAdd }) {
            const [searchQuery, setSearchQuery] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [isSearching, setIsSearching] = useState(false);

            const searchLocation = async (query) => {
                if (query.length < 3) {
                    setSearchResults([]);
                    return;
                }

                setIsSearching(true);
                try {
                    const url = `https://www.meteoblue.com/en/server/search/query3?query=${encodeURIComponent(query)}&apikey=${API_KEY}`;
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.results) {
                        setSearchResults(data.results.slice(0, 10));
                    }
                } catch (err) {
                    console.error('Erreur recherche:', err);
                    setSearchResults([]);
                } finally {
                    setIsSearching(false);
                }
            };

            useEffect(() => {
                const timer = setTimeout(() => {
                    if (searchQuery) {
                        searchLocation(searchQuery);
                    }
                }, 500);

                return () => clearTimeout(timer);
            }, [searchQuery]);

            const handleSelect = (location) => {
                onAdd({
                    name: location.name,
                    lat: location.lat,
                    lon: location.lon,
                    altitude: location.asl || 1000
                });
                setSearchQuery('');
                setSearchResults([]);
                onClose();
            };

            if (!isOpen) return null;

            return (
                <div className="modal-overlay" onClick={onClose}>
                    <div className="modal" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            üèîÔ∏è Ajouter un Secteur
                        </div>
                        
                        <input
                            type="text"
                            className="search-input"
                            placeholder="Rechercher une commune (min. 3 caract√®res - ex: Guzet, Saint-Lary...)"
                            value={searchQuery}
                            onChange={(e) => setSearchQuery(e.target.value)}
                            autoFocus
                        />

                        <div className="search-results">
                            {isSearching && (
                                <div className="loading-search">
                                    üîç Recherche en cours...
                                </div>
                            )}

                            {!isSearching && searchResults.length === 0 && searchQuery.length >= 3 && (
                                <div className="no-results">
                                    Aucun r√©sultat trouv√©. Essayez une autre recherche.
                                </div>
                            )}

                            {!isSearching && searchQuery.length > 0 && searchQuery.length < 3 && (
                                <div className="no-results">
                                    Tapez au moins 3 caract√®res pour lancer la recherche.
                                </div>
                            )}

                            {!isSearching && searchResults.map((result, index) => (
                                <div
                                    key={index}
                                    className="search-result-item"
                                    onClick={() => handleSelect(result)}
                                >
                                    <div className="result-name">{result.name}</div>
                                    <div className="result-info">
                                        üìç {result.country || ''} {result.admin1 ? `‚Ä¢ ${result.admin1}` : ''} {result.asl ? `‚Ä¢ Alt: ${result.asl}m` : ''}
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="modal-buttons">
                            <button className="modal-btn modal-btn-cancel" onClick={onClose}>
                                Annuler
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        function MountainWeatherApp() {
            const [resorts, setResorts] = useState(() => {
                const saved = localStorage.getItem('skiResorts');
                return saved ? JSON.parse(saved) : DEFAULT_RESORTS;
            });
            const [weatherData, setWeatherData] = useState([]);
            const [snowData, setSnowData] = useState([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [currentDate, setCurrentDate] = useState('');
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [lastUpdate, setLastUpdate] = useState(null);
            const [apiCallsLog, setApiCallsLog] = useState(() => {
                const saved = localStorage.getItem('apiCallsLog');
                return saved ? JSON.parse(saved) : [];
            });
            const [viewMode, setViewMode] = useState('day'); // 'day' ou 'hourly'

            // Logger un appel API
            const logApiCall = (resortName, success = true, errorMsg = null) => {
                const logEntry = {
                    timestamp: new Date().toISOString(),
                    resort: resortName,
                    success,
                    error: errorMsg,
                    dateFormatted: new Date().toLocaleString('fr-FR')
                };
                
                const updatedLog = [...apiCallsLog, logEntry];
                setApiCallsLog(updatedLog);
                localStorage.setItem('apiCallsLog', JSON.stringify(updatedLog));
                
                console.log('üìä Appel API:', logEntry);
            };

            // T√©l√©charger le fichier de log
            const downloadLog = () => {
                const logText = apiCallsLog.map(entry => 
                    `${entry.dateFormatted} | ${entry.resort} | ${entry.success ? 'SUCCESS' : 'FAILED'} ${entry.error ? `| Error: ${entry.error}` : ''}`
                ).join('\n');
                
                const blob = new Blob([logText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `meteoblue-api-log-${new Date().toISOString().split('T')[0]}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            };

            // R√©initialiser le log
            const clearLog = () => {
                setApiCallsLog([]);
                localStorage.setItem('apiCallsLog', JSON.stringify([]));
                console.log('üóëÔ∏è Log des appels API r√©initialis√©');
            };

            // Calculer les statistiques
            const getApiStats = () => {
                const today = new Date().toDateString();
                const todayCalls = apiCallsLog.filter(log => 
                    new Date(log.timestamp).toDateString() === today
                );
                
                return {
                    total: apiCallsLog.length,
                    today: todayCalls.length,
                    failed: apiCallsLog.filter(log => !log.success).length
                };
            };

            useEffect(() => {
                const now = new Date();
                setCurrentDate(now.toLocaleDateString('fr-FR', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }) + ' √† ' + now.toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit'
                }));
                
                // Charger la derni√®re mise √† jour depuis localStorage
                const savedUpdate = localStorage.getItem('lastWeatherUpdate');
                if (savedUpdate) {
                    setLastUpdate(savedUpdate);
                }
                
                // Charger les donn√©es au premier chargement (ignore les restrictions)
                if (resorts.length > 0) {
                    loadInitialWeatherData();
                }
            }, []);

            const loadInitialWeatherData = async () => {
                setLoading(true);
                setError(null);
                
                try {
                    const promises = resorts.map(resort => fetchWeatherForResort(resort));
                    const results = await Promise.all(promises);
                    
                    processWeatherData(results);
                    processSnowData(results);
                    
                    // Enregistrer l'heure de mise √† jour
                    const now = new Date();
                    setLastUpdate(now.toISOString());
                    localStorage.setItem('lastWeatherUpdate', now.toISOString());
                    
                    setCurrentDate(now.toLocaleDateString('fr-FR', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    }) + ' √† ' + now.toLocaleTimeString('fr-FR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    }));
                } catch (err) {
                    setError(`Erreur lors de la r√©cup√©ration des donn√©es: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                localStorage.setItem('skiResorts', JSON.stringify(resorts));
            }, [resorts]);

            const addResort = async (newResort) => {
                // Ajouter le secteur √† la liste
                const updatedResorts = [...resorts, newResort];
                setResorts(updatedResorts);
                
                // Charger uniquement les donn√©es pour ce nouveau secteur (sans loading g√©n√©ral)
                try {
                    const result = await fetchWeatherForResort(newResort);
                    
                    // Ajouter les donn√©es m√©t√©o du nouveau secteur
                    if (result.data) {
                        const newWeatherData = processWeatherDataForResort(result);
                        const newSnowData = processSnowDataForResort(result);
                        
                        if (newWeatherData) {
                            setWeatherData(prev => [...prev, newWeatherData]);
                        }
                        if (newSnowData) {
                            setSnowData(prev => [...prev, newSnowData]);
                        }
                    }
                } catch (err) {
                    console.error('Erreur lors de l\'ajout du secteur:', err);
                }
            };

            const removeResort = (index) => {
                // Retirer le secteur et ses donn√©es
                const newResorts = resorts.filter((_, i) => i !== index);
                setResorts(newResorts);
                setWeatherData(prev => prev.filter((_, i) => i !== index));
                setSnowData(prev => prev.filter((_, i) => i !== index));
            };

            const fetchWeatherForResort = async (resort) => {
                // Utiliser le package qui inclut les donn√©es horaires
                const url = `https://my.meteoblue.com/packages/basic-1h_basic-day_clouds-1h_clouds-day_snowice-day?apikey=${API_KEY}&lat=${resort.lat}&lon=${resort.lon}&asl=${resort.altitude}&format=json`;
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        logApiCall(resort.name, false, `HTTP ${response.status}`);
                        throw new Error(`Erreur API pour ${resort.name}: ${response.status}`);
                    }
                    const data = await response.json();
                    logApiCall(resort.name, true);
                    console.log('Donn√©es re√ßues pour', resort.name, ':', data); // Debug
                    return { ...resort, data };
                } catch (err) {
                    console.error(`Erreur pour ${resort.name}:`, err);
                    logApiCall(resort.name, false, err.message);
                    return { ...resort, data: null, error: err.message };
                }
            };

            const fetchAllWeatherData = async () => {
                setLoading(true);
                setError(null);
                
                try {
                    const promises = resorts.map(resort => fetchWeatherForResort(resort));
                    const results = await Promise.all(promises);
                    
                    processWeatherData(results);
                    processSnowData(results);
                    
                    // Enregistrer l'heure de mise √† jour
                    const now = new Date();
                    setLastUpdate(now.toISOString());
                    localStorage.setItem('lastWeatherUpdate', now.toISOString());
                    
                    setCurrentDate(now.toLocaleDateString('fr-FR', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    }) + ' √† ' + now.toLocaleTimeString('fr-FR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    }));
                } catch (err) {
                    setError(`Erreur lors de la r√©cup√©ration des donn√©es: ${err.message}`);
                } finally {
                    setLoading(false);
                }
            };

            const getDayLabel = (offset) => {
                const date = new Date();
                date.setDate(date.getDate() + offset);
                
                if (offset === 0) return "Aujourd'hui";
                if (offset === 1) return 'Demain';
                if (offset === 2) return 'Apr√®s-demain';
                
                const dayName = date.toLocaleDateString('fr-FR', { weekday: 'long' });
                const dateStr = date.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit' });
                return `${dayName.charAt(0).toUpperCase() + dayName.slice(1)} ${dateStr}`;
            };

            const processWeatherDataForResort = (resort) => {
                if (!resort.data || !resort.data.data_day) {
                    console.log('Pas de donn√©es journali√®res pour', resort.name);
                    return null;
                }

                const dayData = resort.data.data_day;
                const hourData = resort.data.data_1h; // Donn√©es horaires
                const days = {};
                
                console.log('Traitement des donn√©es pour', resort.name);
                console.log('- Donn√©es journali√®res (data_day):', dayData ? 'OK' : 'Manquant');
                console.log('- Donn√©es horaires (data_1h):', hourData ? 'OK' : 'Manquant');
                
                // On r√©cup√®re 7 jours : de -2 √† +4 (aujourd'hui = 0)
                for (let offset = -2; offset <= 4; offset++) {
                    const dataIndex = offset + 2;
                    
                    if (dataIndex >= 0 && dataIndex < dayData.time.length) {
                        const weatherCode = dayData.pictocode?.[dataIndex] || 1;
                        const weatherInfo = weatherCodeToIcon[weatherCode] || weatherCodeToIcon[1];
                        
                        // Extraire les donn√©es horaires pour ce jour (10h, 12h, 15h)
                        let hourlyData = null;
                        if (hourData && hourData.time) {
                            const targetDate = dayData.time[dataIndex];
                            console.log(`Extraction donn√©es horaires pour ${targetDate}`);
                            hourlyData = extractHourlyData(hourData, targetDate);
                        }
                        
                        days[offset] = {
                            offset,
                            date: dayData.time?.[dataIndex] || '',
                            condition: weatherInfo.desc,
                            icon: weatherInfo.icon,
                            temp_max: dayData.temperature_max?.[dataIndex] || 0,
                            temp_min: dayData.temperature_min?.[dataIndex] || 0,
                            wind: dayData.windspeed_max?.[dataIndex] || 0,
                            precipitation: dayData.precipitation?.[dataIndex] || 0,
                            hourly: hourlyData
                        };
                    }
                }

                return {
                    name: resort.name,
                    days
                };
            };

            const extractHourlyData = (hourData, targetDate) => {
                if (!hourData || !hourData.time) {
                    console.log('Pas de donn√©es horaires disponibles');
                    return null;
                }
                
                // Trouver les index pour 10h, 12h, 15h du jour cibl√©
                const hours = [10, 12, 15];
                const result = {};
                
                console.log('Recherche des donn√©es pour la date:', targetDate);
                console.log('Premier timestamp disponible:', hourData.time[0]);
                console.log('Dernier timestamp disponible:', hourData.time[hourData.time.length - 1]);
                
                for (let i = 0; i < hourData.time.length; i++) {
                    const timeStr = hourData.time[i];
                    
                    // Format attendu : "2026-02-09T10:00:00Z" ou "2026-02-09 10:00:00"
                    // V√©rifier si c'est le bon jour
                    if (timeStr.startsWith(targetDate)) {
                        // Extraire l'heure de diff√©rents formats possibles
                        let hour;
                        if (timeStr.includes('T')) {
                            // Format ISO: "2026-02-09T10:00:00Z"
                            const timePart = timeStr.split('T')[1];
                            hour = parseInt(timePart.substring(0, 2));
                        } else if (timeStr.includes(' ')) {
                            // Format avec espace: "2026-02-09 10:00:00"
                            const timePart = timeStr.split(' ')[1];
                            hour = parseInt(timePart.substring(0, 2));
                        } else {
                            continue;
                        }
                        
                        if (hours.includes(hour)) {
                            const weatherCode = hourData.pictocode?.[i] || 1;
                            const weatherInfo = weatherCodeToIcon[weatherCode] || weatherCodeToIcon[1];
                            
                            result[hour] = {
                                temp: Math.round(hourData.temperature?.[i] || 0),
                                wind: Math.round(hourData.windspeed?.[i] || 0),
                                icon: weatherInfo.icon,
                                condition: weatherInfo.desc,
                                timestamp: timeStr
                            };
                            
                            console.log(`  ‚úì ${hour}h trouv√©: temp=${result[hour].temp}¬∞, vent=${result[hour].wind}km/h, ${timeStr}`);
                        }
                    }
                }
                
                if (Object.keys(result).length === 0) {
                    console.log('‚ö†Ô∏è Aucune donn√©e horaire trouv√©e pour', targetDate);
                    console.log('   V√©rifier que le package API inclut bien data_1h');
                    return null;
                }
                
                return result;
            };

            const getTempTrend = (temp1, temp2) => {
                const diff = temp2 - temp1;
                if (Math.abs(diff) < 1) return { symbol: '‚Üí', class: 'trend-stable' };
                if (diff > 0) return { symbol: '‚Üó', class: 'trend-up' };
                return { symbol: '‚Üò', class: 'trend-down' };
            };

            const getWindTrend = (wind1, wind2) => {
                const diff = wind2 - wind1;
                if (Math.abs(diff) < 3) return { symbol: '‚Üí', class: 'trend-stable' };
                if (diff > 0) return { symbol: '‚Üó', class: 'trend-up' };
                return { symbol: '‚Üò', class: 'trend-down' };
            };

            const processSnowDataForResort = (resort) => {
                if (!resort.data || !resort.data.data_day) {
                    return null;
                }

                const dayData = resort.data.data_day;
                const snowByDay = [];
                
                // Calculer les chutes de neige pour 7 jours (de -2 √† +4)
                for (let offset = -2; offset <= 4; offset++) {
                    const dataIndex = offset + 2;
                    
                    if (dataIndex >= 0 && dataIndex < dayData.time.length) {
                        const snowFraction = dayData.snowfraction?.[dataIndex] || 0;
                        const precipitation = dayData.precipitation?.[dataIndex] || 0;
                        const snowCm = Math.round(snowFraction * precipitation / 10);
                        snowByDay.push(snowCm);
                    } else {
                        snowByDay.push(0);
                    }
                }

                return {
                    name: resort.name,
                    snowByDay
                };
            };

            const processWeatherData = (results) => {
                const processed = results.map(resort => processWeatherDataForResort(resort)).filter(Boolean);
                setWeatherData(processed);
            };

            const processSnowData = (results) => {
                const processed = results.map(resort => processSnowDataForResort(resort)).filter(Boolean);
                setSnowData(processed);
            };

            if (loading) {
                return (
                    <div className="container">
                        <header>
                            <h1>‚õ∑Ô∏è M√©t√©o Montagne</h1>
                            <div className="subtitle">Dashboard Ski ‚Ä¢ Powered by Meteoblue</div>
                        </header>
                        <div className="main-content">
                            <div className="loading">
                                üîÑ Chargement des donn√©es m√©t√©o depuis Meteoblue...
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container">
                    <header>
                        <h1>‚õ∑Ô∏è M√©t√©o Montagne</h1>
                        <div className="subtitle">Dashboard Ski ‚Ä¢ Powered by Meteoblue</div>
                        <div className="header-controls">
                            <div className="date-display">
                                üìÖ Derni√®re mise √† jour : {currentDate}
                                <div style={{marginTop: '8px', fontSize: '0.85rem', opacity: 0.8}}>
                                    üìä Appels API aujourd'hui : {getApiStats().today} | Total : {getApiStats().total}
                                    {getApiStats().failed > 0 && ` | ‚ö†Ô∏è √âchecs : ${getApiStats().failed}`}
                                </div>
                            </div>
                            <div style={{display: 'flex', flexDirection: 'column', gap: '8px'}}>
                                <button 
                                    className="refresh-btn" 
                                    onClick={fetchAllWeatherData} 
                                    disabled={loading}
                                    style={{
                                        opacity: loading ? 0.5 : 1,
                                        cursor: loading ? 'not-allowed' : 'pointer'
                                    }}
                                >
                                    üîÑ Actualiser
                                </button>
                                <div style={{display: 'flex', gap: '5px'}}>
                                    <button 
                                        onClick={downloadLog}
                                        style={{
                                            padding: '8px 12px',
                                            fontSize: '0.75rem',
                                            background: '#3498db',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '4px',
                                            cursor: 'pointer'
                                        }}
                                        title="T√©l√©charger le log des appels API"
                                    >
                                        üì• Log
                                    </button>
                                    <button 
                                        onClick={clearLog}
                                        style={{
                                            padding: '8px 12px',
                                            fontSize: '0.75rem',
                                            background: '#95a5a6',
                                            color: 'white',
                                            border: 'none',
                                            borderRadius: '4px',
                                            cursor: 'pointer'
                                        }}
                                        title="R√©initialiser le log"
                                    >
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="main-content">
                        {error && (
                            <div className="error">
                                ‚ö†Ô∏è {error}
                            </div>
                        )}

                        <div style={{marginBottom: '30px'}}>
                            <h3 style={{
                                fontFamily: 'Barlow Condensed, sans-serif',
                                fontSize: '1.3rem',
                                color: 'var(--deep-blue)',
                                marginBottom: '15px'
                            }}>
                                üìç Mes Secteurs
                            </h3>
                            {resorts.length > 0 ? (
                                <div className="resort-list">
                                    {resorts.map((resort, index) => (
                                        <div key={index} className="resort-tag">
                                            {resort.name}
                                            <button
                                                className="remove-resort"
                                                onClick={() => removeResort(index)}
                                                title="Retirer ce secteur"
                                            >
                                                √ó
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            ) : (
                                <div style={{
                                    padding: '20px',
                                    background: 'var(--powder)',
                                    borderRadius: '8px',
                                    textAlign: 'center',
                                    color: 'var(--storm-gray)',
                                    fontSize: '0.95rem'
                                }}>
                                    Aucun secteur ajout√©. Cliquez sur "Ajouter un Secteur" pour commencer.
                                </div>
                            )}
                            <button className="add-resort-btn" onClick={() => setIsModalOpen(true)} style={{marginTop: '15px'}}>
                                ‚ûï Ajouter un Secteur
                            </button>
                        </div>

                        {resorts.length > 0 ? (
                            <>
                                {snowData.length > 0 && (
                            <section className="section">
                                <h2>
                                    <span className="icon">‚ùÑÔ∏è</span>
                                    Chutes de Neige (7 jours)
                                </h2>
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Secteur</th>
                                            {[-2, -1, 0, 1, 2, 3, 4].map((offset, i) => (
                                                <th key={offset} className={offset === 0 ? 'today' : ''}>
                                                    {getDayLabel(offset)}
                                                </th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {snowData.map((resort, index) => (
                                            <tr key={index}>
                                                <td>{resort.name} ({resorts[index]?.altitude}m)</td>
                                                {resort.snowByDay.map((snow, dayIndex) => {
                                                    const offset = dayIndex - 2; // convertir index 0-6 en offset -2 √† +4
                                                    return (
                                                        <td key={dayIndex} className={offset === 0 ? 'today' : ''}>
                                                            <span className={`snow-value ${snow > 15 ? 'heavy-snow' : ''}`}>
                                                                {snow} cm
                                                            </span>
                                                        </td>
                                                    );
                                                })}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                                <div className="legend">
                                    <span className="legend-item">üí° <strong>Note :</strong></span>
                                    <span className="legend-item">Les quantit√©s de neige sont des estimations bas√©es sur les pr√©cipitations et la fraction neige/pluie</span>
                                    <span className="legend-item">‚ö†Ô∏è Valeurs en orange = chute importante (&gt;15cm)</span>
                                </div>
                            </section>
                        )}

                        {weatherData.length > 0 && (
                            <section className="section">
                                <h2>
                                    <span className="icon">üå§Ô∏è</span>
                                    M√©t√©o Comparative (7 jours)
                                </h2>
                                
                                <div className="view-toggle-container">
                                    <div style={{fontSize: '0.9rem', color: 'var(--storm-gray)'}}>
                                        üí° Comparez tous vos secteurs en un coup d'≈ìil
                                    </div>
                                    <div className="view-toggle">
                                        <button 
                                            className={`view-toggle-btn ${viewMode === 'day' ? 'active' : ''}`}
                                            onClick={() => setViewMode('day')}
                                        >
                                            üìÖ Vue Jour
                                        </button>
                                        <button 
                                            className={`view-toggle-btn ${viewMode === 'hourly' ? 'active' : ''}`}
                                            onClick={() => setViewMode('hourly')}
                                        >
                                            üïê Vue 3h
                                        </button>
                                    </div>
                                </div>

                                <div className="unified-table-wrapper">
                                    <table className="unified-weather-table">
                                        <thead>
                                            <tr>
                                                <th className="sticky-first-col" style={{background: 'linear-gradient(135deg, var(--deep-blue) 0%, #2874a6 100%)', color: 'white'}}>
                                                    Secteur
                                                </th>
                                                {viewMode === 'day' ? (
                                                    // Vue par jour
                                                    [-2, -1, 0, 1, 2, 3, 4].map((offset) => (
                                                        <th key={offset} className={`day-col-header ${offset === 0 ? 'today-col' : ''}`}
                                                            style={{background: offset === 0 ? '' : 'linear-gradient(135deg, var(--deep-blue) 0%, #2874a6 100%)', color: 'white'}}>
                                                            {getDayLabel(offset)}
                                                        </th>
                                                    ))
                                                ) : (
                                                    // Vue par heure (3 colonnes par jour)
                                                    [-2, -1, 0, 1, 2, 3, 4].map((offset) => (
                                                        <th key={offset} colSpan={3} className={`day-col-header ${offset === 0 ? 'today-col' : ''}`}
                                                            style={{background: offset === 0 ? '' : 'linear-gradient(135deg, var(--deep-blue) 0%, #2874a6 100%)', color: 'white', padding: '8px 4px'}}>
                                                            {getDayLabel(offset)}
                                                        </th>
                                                    ))
                                                )}
                                            </tr>
                                            {viewMode === 'hourly' && (
                                                <tr style={{background: 'linear-gradient(135deg, #5dade2 0%, #85c1e9 100%)', color: 'white'}}>
                                                    <th className="sticky-first-col" style={{background: 'linear-gradient(135deg, #5dade2 0%, #85c1e9 100%)', fontSize: '0.7rem'}}>
                                                        
                                                    </th>
                                                    {[-2, -1, 0, 1, 2, 3, 4].map((offset) => (
                                                        <React.Fragment key={offset}>
                                                            <th className="hourly-col-header">10h</th>
                                                            <th className="hourly-col-header">12h</th>
                                                            <th className="hourly-col-header">15h</th>
                                                        </React.Fragment>
                                                    ))}
                                                </tr>
                                            )}
                                        </thead>
                                        <tbody>
                                            {weatherData.map((resort, resortIndex) => {
                                                const resortInfo = resorts.find(r => r.name === resort.name);
                                                return (
                                                    <tr key={resortIndex}>
                                                        <td className="sticky-first-col">
                                                            {resort.name}
                                                            <div style={{fontSize: '0.7rem', opacity: 0.8, marginTop: '2px'}}>
                                                                ({resortInfo?.altitude || '?'}m)
                                                            </div>
                                                        </td>
                                                        
                                                        {viewMode === 'day' ? (
                                                            // Vue par jour
                                                            [-2, -1, 0, 1, 2, 3, 4].map((offset) => {
                                                                const dayWeather = resort.days[offset];
                                                                if (!dayWeather) return <td key={offset}>-</td>;
                                                                
                                                                const avgTemp = Math.round((dayWeather.temp_max + dayWeather.temp_min) / 2);
                                                                
                                                                return (
                                                                    <td key={offset} className={`day-cell ${offset === 0 ? 'today-cell' : ''}`}>
                                                                        <div className="cell-icon">{dayWeather.icon}</div>
                                                                        <div className="cell-temp-range">
                                                                            {Math.round(dayWeather.temp_min)}¬∞ / {Math.round(dayWeather.temp_max)}¬∞
                                                                        </div>
                                                                        <div className="cell-wind">
                                                                            üí® {Math.round(dayWeather.wind)} km/h
                                                                        </div>
                                                                    </td>
                                                                );
                                                            })
                                                        ) : (
                                                            // Vue par heure
                                                            [-2, -1, 0, 1, 2, 3, 4].map((offset) => {
                                                                const dayWeather = resort.days[offset];
                                                                if (!dayWeather || !dayWeather.hourly) {
                                                                    return (
                                                                        <React.Fragment key={offset}>
                                                                            <td className={`hourly-cell ${offset === 0 ? 'today-cell' : ''}`} style={{fontSize: '0.65rem', color: '#95a5a6'}}>-</td>
                                                                            <td className={`hourly-cell ${offset === 0 ? 'today-cell' : ''}`} style={{fontSize: '0.65rem', color: '#95a5a6'}}>-</td>
                                                                            <td className={`hourly-cell ${offset === 0 ? 'today-cell' : ''}`} style={{fontSize: '0.65rem', color: '#95a5a6'}}>-</td>
                                                                        </React.Fragment>
                                                                    );
                                                                }
                                                                
                                                                return (
                                                                    <React.Fragment key={offset}>
                                                                        {[10, 12, 15].map((hour) => {
                                                                            const hourData = dayWeather.hourly[hour];
                                                                            if (!hourData) {
                                                                                return <td key={hour} className={`hourly-cell ${offset === 0 ? 'today-cell' : ''}`} style={{fontSize: '0.65rem', color: '#95a5a6'}}>-</td>;
                                                                            }
                                                                            
                                                                            return (
                                                                                <td key={hour} className={`hourly-cell ${offset === 0 ? 'today-cell' : ''}`}>
                                                                                    <div className="cell-icon" style={{fontSize: '1.2rem'}}>{hourData.icon}</div>
                                                                                    <div className="cell-temp">{hourData.temp}¬∞</div>
                                                                                    <div className="cell-wind">üí®{hourData.wind}</div>
                                                                                </td>
                                                                            );
                                                                        })}
                                                                    </React.Fragment>
                                                                );
                                                            })
                                                        )}
                                                    </tr>
                                                );
                                            })}
                                        </tbody>
                                    </table>
                                </div>

                                <div className="legend">
                                    <span className="legend-item">üí° <strong>L√©gende :</strong></span>
                                    {viewMode === 'day' ? (
                                        <>
                                            <span className="legend-item">Temp√©ratures : min / max du jour</span>
                                            <span className="legend-item">Vent : rafale maximale</span>
                                        </>
                                    ) : (
                                        <>
                                            <span className="legend-item">Horaires : 10h, 12h, 15h</span>
                                            <span className="legend-item">Temp√©rature et vent √† l'heure pr√©cise</span>
                                        </>
                                    )}
                                    <span className="legend-item">üü¢ Fond vert = Aujourd'hui</span>
                                </div>
                            </section>
                        )}
                        </>) : null}
                    </div>

                    <AddResortModal
                        isOpen={isModalOpen}
                        onClose={() => setIsModalOpen(false)}
                        onAdd={addResort}
                    />
                </div>
            );
        }

        ReactDOM.render(<MountainWeatherApp />, document.getElementById('root'));
    </script>
</body>
</html>
