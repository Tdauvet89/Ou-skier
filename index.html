<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Ski Pro</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #0e1726; color: white; margin: 20px; }
        .container { max-width: 1100px; margin: auto; background: #1b2e4b; padding: 25px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { color: #00b8d4; text-align: center; text-transform: uppercase; letter-spacing: 2px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #1b2e4b; }
        th { background-color: #0e1726; color: #00b8d4; padding: 15px; border: 1px solid #3b3f5c; }
        td { padding: 15px; border: 1px solid #3b3f5c; text-align: center; }
        .resort-name { text-align: left; font-weight: bold; min-width: 180px; }
        .altitude { font-weight: normal; color: #888ea8; font-size: 0.85em; }
        .weather-box { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .temp { font-weight: bold; color: #e2a03f; font-size: 1.2em; }
        .wind { color: #2196f3; font-size: 0.85em; }
        .icon { font-size: 1.8em; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ”ï¸ Dashboard Ski</h1>
    <p style="text-align: center;">Mise Ã  jour : <span id="last-update">--</span></p>

    <table id="weather-table">
        <thead>
            <tr id="header-row">
                <th>SECTEUR</th>
                </tr>
        </thead>
        <tbody id="forecast-body">
            </tbody>
    </table>
</div>

<script>
    const API_KEY = '76O0zHESUwlL5kA1';

    const DEFAULT_RESORTS = [
        { name: "Pic de Midi de Bigorre", lat: 42.9369, lon: 0.1428, altitude: 2877 },
        { name: "Col du Pourtalet", lat: 42.8650, lon: -0.4167, altitude: 1794 },
        { name: "Pic de Lurtet", lat: 42.8500, lon: 0.1000, altitude: 2506 },
        { name: "Station du Lys", lat: 42.8833, lon: -0.1167, altitude: 2450 }
    ];

    const weatherCodeToIcon = {
        1: 'â˜€ï¸', 2: 'ğŸŒ¤ï¸', 3: 'â›…', 4: 'â˜ï¸', 5: 'â˜ï¸', 6: 'â˜ï¸', 
        7: 'ğŸŒ¦ï¸', 8: 'ğŸŒ©ï¸', 9: 'ğŸŒ§ï¸', 10: 'ğŸŒ§ï¸', 11: 'â›ˆï¸', 
        12: 'ğŸŒ§ï¸', 13: 'ğŸŒ¨ï¸', 14: 'â„ï¸', 15: 'â„ï¸'
    };

    async function initDashboard() {
        const tbody = document.getElementById('forecast-body');
        const headerRow = document.getElementById('header-row');
        tbody.innerHTML = "<tr><td colspan='8'>Chargement des donnÃ©es...</td></tr>";

        let firstLoad = true;

        for (const resort of DEFAULT_RESORTS) {
            try {
                // Utilisation du package 'basic-1h_basic-day' qui est plus complet et stable
                const url = `https://my.meteoblue.com/packages/basic-1h_basic-day?lat=${resort.lat}&lon=${resort.lon}&asl=${resort.altitude}&key=${API_KEY}&format=json`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (firstLoad) {
                    tbody.innerHTML = ""; // On vide le message de chargement
                    data.data_day.time.forEach(dateStr => {
                        const d = new Date(dateStr);
                        const th = document.createElement('th');
                        th.innerText = d.toLocaleDateString('fr-FR', { day: '2-digit', month: '02' });
                        headerRow.appendChild(th);
                    });
                    firstLoad = false;
                }

                const tr = document.createElement('tr');
                let html = `<td class="resort-name">${resort.name} <span class="altitude">(${resort.altitude}m)</span></td>`;

                for (let i = 0; i < data.data_day.time.length; i++) {
                    const icon = weatherCodeToIcon[data.data_day.pictocode[i]] || 'ğŸŒ¡ï¸';
                    const tempMax = data.data_day.temp_max[i].toFixed(1);
                    const wind = Math.round(data.data_day.windspeed_max[i]);

                    html += `
                        <td>
                            <div class="weather-box">
                                <span class="icon">${icon}</span>
                                <span class="temp">${tempMax}Â°C</span>
                                <span class="wind">ğŸ’¨ ${wind} <small>km/h</small></span>
                            </div>
                        </td>`;
                }
                tr.innerHTML = html;
                tbody.appendChild(tr);

            } catch (error) {
                console.error("Erreur pour " + resort.name, error);
            }
        }
        document.getElementById('last-update').innerText = new Date().toLocaleString();
    }

    initDashboard();
</script>
</body>
</html>
